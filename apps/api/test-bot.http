### ============================================
### Restaurant SaaS - Bot API Test Suite
### ============================================
### Tests conversational bot with deterministic FSM
### Covers: Full conversation flows, state transitions, intent detection

@baseUrl = http://localhost:3000
@slug = test-restaurant
@sessionId = bot-test-{{$guid}}

### ============================================
### 1. GREETING STATE - Welcome Message
### ============================================

### 1.1 Start Conversation (GREETING state)
# @name greeting
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "Hello",
  "channel": "WEB"
}

### 1.2 Check Session State
GET {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/session/{{sessionId}}

### ============================================
### 2. BROWSE_MENU STATE - Show Categories
### ============================================

### 2.1 Request Menu
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "show me the menu"
}

### 2.2 Alternative: "What can I order?"
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "what can i order"
}

### ============================================
### 3. ITEM_DETAILS STATE - View Specific Item
### ============================================

### 3.1 Select Item by Number
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "1"
}

### 3.2 Select Item by Name
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "show me garlic bread"
}

### ============================================
### 4. CART STATE - Add Items and Manage Cart
### ============================================

### 4.1 Add Item to Cart
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "add to cart"
}

### 4.2 Add Multiple Quantity
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "add 2 more"
}

### 4.3 View Cart
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "show my cart"
}

### 4.4 Alternative: "View cart"
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "cart"
}

### 4.5 Remove Item from Cart (by number)
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "remove 1"
}

### ============================================
### 5. CUSTOMER_INFO STATE - Collect Information
### ============================================

### 5.1 Proceed to Checkout
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "checkout"
}

### 5.2 Provide Name
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "John Doe"
}

### 5.3 Provide Email
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "john.doe@example.com"
}

### 5.4 Provide Phone
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "+1234567890"
}

### ============================================
### 6. CONFIRM STATE - Review and Confirm Order
### ============================================

### 6.1 View Confirmation (auto-shown after info collected)
# Check session state - should be in CONFIRM
GET {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/session/{{sessionId}}

### 6.2 Confirm Order
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "yes"
}

### 6.3 Alternative: "confirm"
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "confirm"
}

### ============================================
### 7. PAYMENT STATE - Get Checkout Link
### ============================================

### 7.1 Request Payment Link
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "pay"
}

### 7.2 Alternative: "make payment"
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "make payment"
}

### ============================================
### 8. STATUS STATE - Check Order Status
### ============================================

### 8.1 Check Status
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "check status"
}

### 8.2 Alternative: "where is my order"
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "where is my order"
}

### 8.3 Track Order
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "track order"
}

### ============================================
### 9. HELP STATE - Get Assistance
### ============================================

### 9.1 Request Help
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "help"
}

### 9.2 Alternative: "what can you do"
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "what can you do"
}

### ============================================
### 10. NAVIGATION - Back and Reset
### ============================================

### 10.1 Go Back
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "go back"
}

### 10.2 Start Over
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{sessionId}}",
  "message": "start over"
}

### ============================================
### 11. COMPLETE CONVERSATION FLOW
### ============================================

### 11.1 New Session - Greeting
@fullFlowSession = bot-full-{{$guid}}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "hi"
}

### 11.2 Browse Menu
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "show menu"
}

### 11.3 View Item Details
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "1"
}

### 11.4 Add to Cart
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "add to cart"
}

### 11.5 Checkout
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "checkout"
}

### 11.6 Provide Name
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "Alice Smith"
}

### 11.7 Provide Email
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "alice@test.com"
}

### 11.8 Provide Phone
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "+19876543210"
}

### 11.9 Confirm Order
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "yes"
}

### 11.10 Get Payment Link
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{fullFlowSession}}",
  "message": "pay"
}

### 11.11 Check Final Session State
GET {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/session/{{fullFlowSession}}

### ============================================
### 12. INTENT DETECTION TESTS
### ============================================

### 12.1 Greeting Variations
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "intent-test-{{$guid}}",
  "message": "hey there"
}

### 12.2 Menu Request Variations
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "intent-test-{{$guid}}",
  "message": "what do you have"
}

### 12.3 Add to Cart Variations
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "intent-test-{{$guid}}",
  "message": "i want that"
}

### 12.4 Checkout Variations
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "intent-test-{{$guid}}",
  "message": "place order"
}

### 12.5 Help Variations
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "intent-test-{{$guid}}",
  "message": "i need help"
}

### ============================================
### 13. EDGE CASES
### ============================================

### 13.1 Unknown Intent
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "edge-test-{{$guid}}",
  "message": "xyzabc nonsense"
}

### 13.2 Empty Cart Checkout
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "empty-cart-{{$guid}}",
  "message": "hi"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "empty-cart-{{$guid}}",
  "message": "checkout"
}

### 13.3 Very Long Message
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "long-msg-{{$guid}}",
  "message": "I would really love to order something delicious from your restaurant because I'm very hungry and I heard great things about your food"
}

### 13.4 Special Characters
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "special-{{$guid}}",
  "message": "hello! ðŸ˜Š what's on the menu?"
}

### 13.5 Invalid Session ID (should create new)
GET {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/session/nonexistent-session-id

### ============================================
### 14. CANCEL ORDER FLOW
### ============================================

### 14.1 Start and Create Order
@cancelSession = bot-cancel-{{$guid}}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "hi"
}

### 14.2 Browse and Add Item
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "menu"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "1"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "add"
}

### 14.3 Proceed Through Checkout
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "checkout"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "Bob"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "bob@test.com"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "+11234567890"
}

POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "yes"
}

### 14.4 Cancel Order
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "{{cancelSession}}",
  "message": "cancel"
}

### ============================================
### 15. MULTI-CHANNEL TESTS
### ============================================

### 15.1 Web Channel (default)
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "web-{{$guid}}",
  "message": "hello",
  "channel": "WEB"
}

### 15.2 SMS Channel
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "sms-{{$guid}}",
  "message": "menu",
  "channel": "SMS"
}

### 15.3 WhatsApp Channel
POST {{baseUrl}}/api/v1/public/restaurants/{{slug}}/bot/message
Content-Type: application/json

{
  "sessionId": "whatsapp-{{$guid}}",
  "message": "help",
  "channel": "WHATSAPP"
}

### ============================================
### END OF TESTS
### ============================================
